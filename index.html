<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Life Timer | G-5600UE Dashboard</title>
    <style>
        :root {
            --bg-color: #222;
            --text-color: #eee;
            --muted-text-color: #aaa;
            --bar-bg-color: #444;
            --ruler-line-color: #aaa;
            --decayed-color: #9932CC;
            --spent-color: #3d3d3d;      
            --future-color: #66FF66;
            --cache-bg-color: #333;
            --ticket-ready-color: #66FF66; 
        }

        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            padding: 40px 0;
        }

        .header-container { display: flex; align-items: center; width: 1200px; margin-bottom: 20px; }
        .casio-clock { margin-right: 30px; }
        #hour-hand, #minute-hand { transform-origin: 50px 50px; transition: transform 0.5s cubic-bezier(0.4, 2.1, 0.6, 1); }

        .summary-block { text-align: left; }
        #day-of-week { font-size: 2.2em; font-weight: 800; }
        #yearly-progress { color: var(--muted-text-color); margin-bottom: 10px; }

        .bar-container { width: 1200px; text-align: center; }
        #status-display { font-size: 2.8em; font-weight: bold; margin-bottom: 25px; }
        
        .progress-bar { width: 100%; height: 80px; background-color: var(--bar-bg-color); border-radius: 4px; overflow: hidden; position: relative; }
        #progress-fill { height: 100%; width: 100%; transform-origin: left; background-color: var(--spent-color); }
        #progress-marker { position: absolute; top: 70px; left: 0; height: 100px; width: 3px; background-color: #FF0000; z-index: 10; }

        .pomodoro-flex { display: flex; justify-content: space-between; width: 1140px; padding: 30px; background: #333; border-radius: 8px; margin-top: 40px; border: 1px solid #444; }
        
        .pomo-log-column { width: 30%; background: #222; border: 1px solid #555; border-radius: 4px; display: flex; flex-direction: column; height: 220px; }
        .log-header { font-size: 0.7em; padding: 8px; border-bottom: 1px solid #555; background: #444; display: flex; justify-content: space-between; font-weight: bold; }
        .log-body { flex-grow: 1; overflow-y: auto; font-family: monospace; font-size: 0.85em; }
        .log-entry { padding: 4px 8px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; }
        .log-tag { font-size: 0.7em; background: #9932CC; padding: 2px 4px; border-radius: 3px; margin-left: 5px; }

        .controls { width: 25%; }
        select, button { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 4px; border: none; font-weight: bold; cursor: pointer; }
        select { background: #444; color: #fff; }
        #pomo-start { background: #66FF66; color: #000; }
        #pomo-stop { background: #f44336; color: #fff; }

        .visuals { width: 40%; display: flex; justify-content: space-around; align-items: center; }
        .timer-svg { transform: rotate(-90deg); }
        .circle-bg { fill: none; stroke: #444; stroke-width: 4; }
        .circle-fill { fill: #66FF66; transition: r 0.3s; }
        .label-sub { font-size: 0.7em; text-transform: uppercase; color: #aaa; text-align: center; margin-top: 10px; font-weight: bold; }
    </style>
</head>
<body>

    <div class="header-container">
        <div class="casio-clock">
            <svg width="100" height="100" viewBox="0 0 100 100">
                <circle cx="50" cy="50" r="48" fill="none" stroke="#666" stroke-width="2" />
                <line id="hour-hand" x1="50" y1="50" x2="50" y2="32" stroke="#eee" stroke-width="4" stroke-linecap="round" />
                <line id="minute-hand" x1="50" y1="50" x2="50" y2="15" stroke="#66FF66" stroke-width="2" stroke-linecap="round" />
            </svg>
        </div>
        <div class="summary-block">
            <div id="day-of-week"></div>
            <div id="yearly-progress">Syncing with system clock...</div>
        </div>
    </div>

    <div class="bar-container">
        <div id="status-display">INITIALIZING...</div>
        <div class="progress-bar"><div id="progress-fill"></div></div>
        <div id="progress-marker"></div>
    </div>

    <div class="pomodoro-flex">
        <div class="pomo-log-column">
            <div class="log-header"><span>SESSION LOG</span><span>DAILY TOTAL: <span id="log-total-mins">0</span>m</span></div>
            <div id="pomo-log-body" class="log-body"></div>
        </div>

        <div class="controls">
            <select id="pomo-minutes"></select>
            <button id="pomo-start">START SESSION</button>
            <button id="pomo-stop">STOP / YIELD</button>
            <div style="text-align: center; font-family: monospace; font-size: 1.1em; margin-top: 10px;">
                <span id="pomo-timer-text">00:00</span> | Count: <span id="pomo-count-text">0</span>
            </div>
        </div>

        <div class="visuals">
            <div>
                <svg width="120" height="120" class="timer-svg">
                    <circle class="circle-bg" cx="60" cy="60" r="55"></circle>
                    <circle id="pomo-circle" class="circle-fill" cx="60" cy="60" r="55"></circle>
                </svg>
                <div class="label-sub">Pomo Focus</div>
            </div>
            <div>
                <svg width="120" height="120" class="timer-svg">
                    <circle class="circle-bg" cx="60" cy="60" r="55"></circle>
                    <circle id="global-circle" class="circle-fill" cx="60" cy="60" r="55" style="fill: #9932CC;"></circle>
                </svg>
                <div class="label-sub">Day Decay</div>
            </div>
        </div>
    </div>

    <script>
        const START_HOUR = 6, END_HOUR = 23, TOTAL_MIN = (END_HOUR - START_HOUR) * 60;
        
        // --- LOCAL STORAGE & STATE ---
        let dailyTotalMins = parseInt(localStorage.getItem('dailyTotalMins')) || 0;
        let pomoStartTime = localStorage.getItem('pomoStartTime') ? parseInt(localStorage.getItem('pomoStartTime')) : null;
        let activeBlock = parseInt(localStorage.getItem('activeBlock')) || 25;

        document.getElementById('log-total-mins').textContent = dailyTotalMins;

        // Populate Dropdown
        const select = document.getElementById('pomo-minutes');
        for(let i=1; i<=60; i++) {
            let opt = document.createElement('option'); opt.value = i; opt.innerHTML = `${i} Minutes`;
            if(i === activeBlock) opt.selected = true;
            select.appendChild(opt);
        }

        function updateMainDisplays() {
            const now = new Date(); 
            const cH = now.getHours(), cM = now.getMinutes(), cS = now.getSeconds();
            
            // Global Day Decay
            let mins = (cH < START_HOUR) ? 0 : (cH >= END_HOUR) ? TOTAL_MIN : (cH * 60 + cM) - (START_HOUR * 60);
            const pElap = (mins / TOTAL_MIN) * 100;
            
            document.getElementById('progress-fill').style.transform = `scaleX(${pElap / 100})`;
            document.getElementById('progress-marker').style.left = `${(pElap / 100) * 1200}px`;
            document.getElementById('status-display').textContent = `${Math.round(pElap)}% CONSUMED (${TOTAL_MIN - mins}m Left)`;
            document.getElementById('day-of-week').textContent = now.toLocaleDateString('en-US', {weekday: 'long'});
            document.getElementById('yearly-progress').textContent = now.toLocaleDateString('en-US', {day:'numeric', month:'long', year:'numeric'});

            // Casio Hands
            document.getElementById('hour-hand').style.transform = `rotate(${(cH % 12) * 30 + (cM * 0.5)}deg)`;
            document.getElementById('minute-hand').style.transform = `rotate(${cM * 6}deg)`;
            document.getElementById('global-circle').setAttribute('r', ((100-pElap)/100)*55);

            // Pomodoro Logic (Time-Based to prevent background pause)
            if (pomoStartTime) {
                const totalSecsInBlock = activeBlock * 60;
                const totalElapsedSecs = Math.floor((Date.now() - pomoStartTime) / 1000);
                const currentCount = Math.floor(totalElapsedSecs / totalSecsInBlock);
                const secsIntoCurrentCycle = totalElapsedSecs % totalSecsInBlock;
                const secsRemainingInCycle = totalSecsInBlock - secsIntoCurrentCycle;

                const displayM = Math.floor(secsRemainingInCycle / 60);
                const displayS = secsRemainingInCycle % 60;

                document.getElementById('pomo-timer-text').textContent = `${displayM}:${displayS.toString().padStart(2, '0')}`;
                document.getElementById('pomo-count-text').textContent = currentCount;
                document.getElementById('pomo-circle').setAttribute('r', (secsRemainingInCycle / totalSecsInBlock) * 55);
            }
        }

        document.getElementById('pomo-start').onclick = () => {
            // If already running, finalize it first
            if(pomoStartTime) finalizeSession();
            
            activeBlock = parseInt(select.value);
            pomoStartTime = Date.now();
            
            localStorage.setItem('pomoStartTime', pomoStartTime);
            localStorage.setItem('activeBlock', activeBlock);
            
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = `<span>â–¶ ${new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</span> <span>BLOCK: ${activeBlock}m</span>`;
            document.getElementById('pomo-log-body').prepend(entry);
        };

        document.getElementById('pomo-stop').onclick = () => {
            finalizeSession();
        };

        function finalizeSession() {
            if (!pomoStartTime) return;
            
            const totalElapsedSecs = Math.floor((Date.now() - pomoStartTime) / 1000);
            const completedBlocks = Math.floor(totalElapsedSecs / (activeBlock * 60));
            const earnedMins = completedBlocks * activeBlock;
            
            dailyTotalMins += earnedMins;
            localStorage.setItem('dailyTotalMins', dailyTotalMins);
            document.getElementById('log-total-mins').textContent = dailyTotalMins;

            const lastEntry = document.getElementById('pomo-log-body').firstChild;
            if(lastEntry) {
                const tag = document.createElement('span');
                tag.className = 'log-tag';
                tag.textContent = `YIELD: ${earnedMins}m`;
                lastEntry.appendChild(tag);
            }

            pomoStartTime = null;
            localStorage.removeItem('pomoStartTime');
            document.getElementById('pomo-timer-text').textContent = "00:00";
            document.getElementById('pomo-count-text').textContent = "0";
            document.getElementById('pomo-circle').setAttribute('r', 55);
        }

        // Auto-refresh at 4 AM for system stability
        setInterval(() => {
            const h = new Date().getHours(), m = new Date().getMinutes();
            if(h === 4 && m === 0) window.location.reload();
        }, 60000);

        setInterval(updateMainDisplays, 1000);
        updateMainDisplays();
    </script>
</body>
</html>
